<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Auction Page</title>
    <style>
        .auction-container {
            display: flex;
            align-items: flex-start;
            margin: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            background-color: #fff;
        }

        .auction-image img {
            margin: auto;
            max-width: 300px;
            height: auto;
            border: 1px solid #ddd;
        }

        .auction-details {
            max-width: 500px;
            width: 100%;
            margin-left: auto;
        }

        .quick-bid-options button {
            display: block;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        .custom-bid {
            display: flex;
            margin-top: 20px;
        }

        .custom-bid input {
            flex-grow: 1;
            margin-right: 5px;
        }

        .custom-bid button {
            padding: 10px 20px;
            background-color: #000000;
            border: none;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    {% extends 'base.html' %}

    {% block content %}
    <form id="bid_form" action="{% url 'orders:bid_participation' product.id %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="product" value="{{ product.id }}">
        <input type="hidden" id="bid_price" name="price" value="">

        {% with current_bid=product.present_max_bid_price|default_if_none:product.min_bid_price %}
        <div class="auction-container" data-current-bid="{{ current_bid }}" data-bid-increment="{{ product.bid_increment }}">
            <!-- 상품 이미지 -->
            <div class="auction-image">
                <img src="{{ product.image_url }}" alt="Product Image" />
            </div>
        
            <!-- 상품 상세 정보 -->
            <div class="auction-details">
                <h1>{{ product.name }}</h1>
                <p>경매 종료 시간: {{ product.auction_end_time }}</p>
                {% if product.product_status %}
                <p id="time-remaining">남은 시간: 계산 중...</p>
                <p>현재 입찰가: ₩{{ current_bid }}</p>
                <p>입찰 단위: ₩{{ product.bid_increment }}</p>
                <!-- 빠른 입찰 옵션 -->
                <p>빠른 입찰</p>
                <div class="quick-bid-options">
                    <button type="button" onclick="setBid(1)">₩{{ current_bid|add:product.bid_increment }}</button>
                    <button type="button" onclick="setBid(2)">₩{{ current_bid|add:product.bid_increment|add:product.bid_increment }}</button>
                    <button type="button" onclick="setBid(3)">₩{{ current_bid|add:product.bid_increment|add:product.bid_increment|add:product.bid_increment }}</button>
                </div>            
                <!-- 사용자 지정 입찰 -->
                <div class="custom-bid">
                    <input type="number" id="custom_bid_input" placeholder="₩{{ current_bid|add:product.bid_increment }}" />
                    <button type="button" onclick="setCustomBid()">입찰</button>
                </div>
                {% endif %}
            </div>
        </div>
        {% endwith %}        
    </form>
    <script>
        // 카운트다운 할 날짜 설정
        var countDownDate = new Date("{{ product.auction_end_time|date:'Y/m/d H:i:s' }}").getTime();


        // 1초마다 카운트 다운 업데이트
        var countdownfunction = setInterval(function() {

            // 현재 날짜와 시간 가져오기
            var now = new Date().getTime();

            // 남은 시간 계산하기
            var timeRemaining = countDownDate - now;

            // 날짜, 시간, 분, 초 단위로 시간 계산
            var days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
            var hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

            // id="time-remaining"인 요소에 결과 출력
            document.getElementById("time-remaining").innerHTML = "남은 시간: " + days + "일 " + hours + "시간 "
            + minutes + "분 " + seconds + "초 ";

            // 카운트 다운이 끝나면 텍스트 출력
            if (timeRemaining < 0) {
                clearInterval(countdownfunction);
                document.getElementById("time-remaining").innerHTML = "경매가 종료되었습니다";
            }
        }, 1000);


        function setBid(multiplier) {
            var container = document.querySelector('.auction-container');
            var base = parseInt(container.getAttribute('data-current-bid'), 10);
            var increment = parseInt(container.getAttribute('data-bid-increment'), 10);
            var newBid = base + increment * multiplier;
            document.getElementById('bid_price').value = newBid;
            document.getElementById('bid_form').submit();
        }

        function setCustomBid() {
            var customAmount = document.getElementById('custom_bid_input').value.trim();
            if (customAmount) {
                document.getElementById('bid_price').value = parseInt(customAmount, 10);
                document.getElementById('bid_form').submit();
            } else {
                alert('유효한 입찰가를 입력해주세요.');
            }
        }
    </script>
    {% endblock %}
</body>
</html>
